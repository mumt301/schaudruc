<html>
    <head>
        <title>MusicBrainz API Call</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <div>
            <h2>Basic Call to the MusicBrainz API</h2>
            <p>Retrieve MBID, album discography, and dates of release.</p>

            <form method="GET">
                <label for="name">Artist name?</label>
                <input type="text" name="artist" id="name">
                <input type="submit" value="Get MBID">
            </form>

            <p id="placeholder"></p>

        </div>

        <script type="text/JavaScript">
            function queryArtist() {
                let params = (new URL(document.location)).searchParams;
                if (params.has('artist')) {
                    let artistName = params.get('artist');
                    console.log(artistName);

                    let mBaseURL = "https://musicbrainz.org/ws/2/";
                    let mbResource = "artist?query=";
                    let queryURL = mBaseURL + mbResource + artistName;
                    console.log(queryURL);

                    httpGet(queryURL, getMBID);
                }
            }

            function httpGet(theURL, cbFunction) {
                let xmlHttp = new XMLHttpRequest();
                xmlHttp.open("GET", theURL);
                xmlHttp.send();
                xmlHttp.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        cbFunction(this);
                    }
                };
            }

            function getMBID(xhttp) {
                let retrievedData = xhttp.responseXML;
                console.log(retrievedData);
                let artistData = retrievedData.getElementsByTagName('artist')[0];
                let artistMBID = artistData.id;
                console.log(artistMBID);
                let artistName = artistData.getElementsByTagName('name')[0].innerHTML;
                console.log(artistName);

                let placeholder = document.getElementById('placeholder');
                placeholder.innerHTML = `For ${artistName} the MusicBrainz ID is ${artistMBID}`;
            }


            function queryAlbums() {
                let params = (new URL(document.location)).searchParams;
                if (params.has('release-group-list')) {
                    let artistAlbums = params.get('release-group-list');
                    console.log(artistAlbums);

                    let mBaseURL = "https://musicbrainz.org/ws/2/";
                    let mbResource = "release-group?artist=&type=album&limit=1000";
                    let queryURL2 = mBaseURL + mbResource + artistMBID;
                    console.log(queryURL2);

                    httpGet(queryURL2, getAlbums);
                }
            }

            function httpGet(theURL2, getAlbums) {
                let xmlHttp = new XMLHttpRequest();
                xmlHttp.open("GET", theURL);
                xmlHttp.send();
                xmlHttp.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        getAlbums(this);
                    }
                };
            }

            function getMBID(xhttp) {
                let retrievedData = xhttp.responseXML;
                console.log(retrievedData);
                let artistData = retrievedData.getElementsByTagName('artist')[0];
                let artistMBID = artistData.id;
                console.log(artistMBID);
                let artistName = artistData.getElementsByTagName('name')[0].innerHTML;
                console.log(artistName);

                let placeholder = document.getElementById('placeholder');
                placeholder.innerHTML = `For ${artistName} the MusicBrainz ID is ${artistMBID}`;
            }

            function getAlbums(xhttp) {
                 let retrievedData = xhttp.responseXML;
                 console.log(retrievedData);
                 let albumData = retrievedData.getElementsByTagName('release-group');
                 let albumTitle = albumData.getElementsByTagName('title').innerHTML;
                 console.log(albumTitle)
                 let albumDate = albumData.getElementsByTagName('first-release-date').innerHTML;
                 console.log(albumDate);

                 let placeholder = document.getElementById('placeholder');
                placeholder.innerHTML = `For ${artistName}, the title of an album is ${albumTitle} and the date of release is ${albumDate}`;
            }

            window.onload = queryArtist;
        </script>
    </body>
</html>